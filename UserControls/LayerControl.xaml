<UserControl x:Class="MVVMPaintApp.UserControls.LayerControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:conv="Mvv"
             xmlns:local="clr-namespace:MVVMPaintApp.UserControls"
             mc:Ignorable="d" 
             d:DesignHeight="450" d:DesignWidth="100">
    <UserControl.Resources>
        <Style x:Key="LayerAddButtonStyle" TargetType="{x:Type ButtonBase}">
            <Setter Property="FrameworkElement.FocusVisualStyle" Value="{DynamicResource DefaultControlFocusVisualStyle}" />
            <Setter Property="Background" Value="Transparent" />
            <Setter Property="Foreground" Value="{DynamicResource ButtonForeground}" />
            <Setter Property="BorderBrush" Value="Transparent" />
            <Setter Property="BorderThickness" Value="{StaticResource ButtonBorderThemeThickness}" />
            <Setter Property="Padding" Value="5" />
            <Setter Property="HorizontalAlignment" Value="Left" />
            <Setter Property="VerticalAlignment" Value="Center" />
            <Setter Property="HorizontalContentAlignment" Value="Center" />
            <Setter Property="VerticalContentAlignment" Value="Center" />
            <Setter Property="FontSize" Value="{DynamicResource ControlContentThemeFontSize}" />
            <Setter Property="FontWeight" Value="Normal" />
            <Setter Property="Border.CornerRadius" Value="{DynamicResource ControlCornerRadius}" />
            <Setter Property="UIElement.SnapsToDevicePixels" Value="True" />
            <Setter Property="FrameworkElement.OverridesDefaultStyle" Value="True" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="{x:Type Button}">
                        <Border Name="ContentBorder" Width="{TemplateBinding FrameworkElement.Width}" Height="{TemplateBinding FrameworkElement.Height}" MinWidth="{TemplateBinding FrameworkElement.MinWidth}" MinHeight="{TemplateBinding FrameworkElement.MinHeight}" Padding="{TemplateBinding Control.Padding}" HorizontalAlignment="{TemplateBinding FrameworkElement.HorizontalAlignment}" VerticalAlignment="{TemplateBinding FrameworkElement.VerticalAlignment}" Background="{TemplateBinding Control.Background}" BorderBrush="{TemplateBinding Control.BorderBrush}" BorderThickness="{TemplateBinding Control.BorderThickness}" CornerRadius="{TemplateBinding Border.CornerRadius}">
                            <ContentPresenter Name="ContentPresenter" HorizontalAlignment="{TemplateBinding Control.HorizontalContentAlignment}" VerticalAlignment="{TemplateBinding Control.VerticalContentAlignment}" Content="{TemplateBinding ContentControl.Content}" ContentTemplate="{TemplateBinding ContentControl.ContentTemplate}" TextElement.Foreground="{TemplateBinding Control.Foreground}" />
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="UIElement.IsMouseOver" Value="True">
                                <Setter Value="{DynamicResource ButtonBackgroundPointerOver}" Property="Background" />
                                <Setter Value="{DynamicResource ControlElevationBorderBrush}" Property="BorderBrush" />
                                <Setter TargetName="ContentPresenter" Value="{DynamicResource ButtonForegroundPointerOver}" Property="TextElement.Foreground" />
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter Value="{DynamicResource ButtonBackgroundDisabled}" Property="Background" />
                                <Setter Value="{DynamicResource ButtonBorderBrushDisabled}" Property="BorderBrush" />
                                <Setter TargetName="ContentPresenter" Value="{DynamicResource ButtonForegroundDisabled}" Property="TextElement.Foreground" />
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter Value="{DynamicResource ButtonBackgroundPressed}" Property="Background" />
                                <Setter Value="{DynamicResource ButtonBorderBrushPressed}" Property="BorderBrush" />
                                <Setter TargetName="ContentPresenter" Value="{DynamicResource ButtonForegroundPressed}" Property="TextElement.Foreground" />
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        <DrawingImage x:Key="LayerAddButtonIcon">
            <DrawingImage.Drawing>
                <DrawingGroup ClipGeometry="M0,0 V14 H14 V0 H0 Z">
                    <GeometryDrawing Brush="{DynamicResource TextFillColorPrimaryBrush}" Geometry="F0 M14,14z M0,0z M12.6666,7.00004C12.6666,3.87033 10.1297,1.33337 6.99998,1.33337 3.87026,1.33337 1.33331,3.87033 1.33331,7.00004 1.33331,10.1298 3.87026,12.6667 6.99998,12.6667 10.1297,12.6667 12.6666,10.1298 12.6666,7.00004z M13.6666,7.00004C13.6666,3.31804 10.682,0.333374 6.99998,0.333374 3.31798,0.333374 0.333313,3.31804 0.333313,7.00004 0.333313,10.682 3.31798,13.6667 6.99998,13.6667 10.682,13.6667 13.6666,10.682 13.6666,7.00004z" />
                    <GeometryDrawing Brush="{DynamicResource TextFillColorPrimaryBrush}" Geometry="F0 M14,14z M0,0z M7.49999,6.49996L9.83302,6.49996 9.90132,6.50463C10.0268,6.52189 10.1411,6.58616 10.221,6.68443 10.301,6.7827 10.3406,6.90765 10.332,7.03404 10.3234,7.16043 10.2671,7.27883 10.1745,7.36531 10.082,7.4518 9.96,7.49992 9.83332,7.49996L7.49999,7.49996 7.49999,9.83299 7.49532,9.90129C7.47806,10.0268 7.41379,10.1411 7.31552,10.221 7.21725,10.3009 7.0923,10.3406 6.96591,10.332 6.83952,10.3233 6.72112,10.2671 6.63464,10.1745 6.54815,10.0819 6.50003,9.95997 6.49999,9.83329L6.49999,7.49996 4.16696,7.49996 4.09866,7.49529C3.97316,7.47802 3.85889,7.41376 3.77894,7.31549 3.699,7.21722 3.65934,7.09227 3.66797,6.96588 3.67661,6.83949 3.7329,6.72109 3.82546,6.63461 3.91803,6.54812 4.03997,6.5 4.16666,6.49996L6.49999,6.49996 6.49999,4.16732 6.50466,4.09863C6.52109,3.97892 6.58031,3.86922 6.67137,3.7898 6.76243,3.71039 6.87916,3.66663 6.99999,3.66663 7.1326,3.66663 7.25978,3.7193 7.35354,3.81307 7.44731,3.90684 7.49999,4.03432 7.49999,4.16693L7.49999,6.49996z" />
                </DrawingGroup>
            </DrawingImage.Drawing>
        </DrawingImage>
    </UserControl.Resources>
    <Border BorderBrush="{DynamicResource ControlOnImageFillColorDefaultBrush}" BorderThickness="1" CornerRadius="15" ClipToBounds="True">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="*" />
                <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>

            <Button Grid.Row="0" HorizontalAlignment="Center" VerticalAlignment="Center"
            Width="30" Height="30" Margin="0,7,0,7" Style="{StaticResource LayerAddButtonStyle}"
                    Command="{Binding AddLayerCommand}">
                <Image Source="{StaticResource LayerAddButtonIcon}" Stretch="UniformToFill"/>
            </Button>
            <Line Grid.Row="1" Stroke="{DynamicResource ControlElevationBorderBrush}" X1="0" Y1="0" X2="120" Y2="0" StrokeThickness="1"/>
            <ListView Grid.Row="1" 
                      x:Name="LayerControlListView"
                      ItemsSource="{Binding Layers}"
                      SelectedItem="{Binding SelectedLayer}"
                      SelectionChanged="ListView_SelectionChanged"
                      VirtualizingPanel.ScrollUnit="Pixel">
                <ListView.ItemTemplate>
                    <DataTemplate>
                        <Grid>
                            <Border Width="80" Height="80" MaxHeight="80" MaxWidth="80" BorderBrush="{DynamicResource ControlElevationBorderBrush}" BorderThickness="1" Margin="0,10,5,10" CornerRadius="10">
                                <Image Source="{Binding LayerThumbnail}" Margin="2" RenderOptions.BitmapScalingMode="HighQuality"/>
                            </Border>
                        </Grid>
                    </DataTemplate>
                </ListView.ItemTemplate>
                <ListView.ContextMenu>
                    <ContextMenu Opened="LayerContextMenu_Opened">
                        <MenuItem Command="{Binding ToggleVisibilityCommand}">
                            <MenuItem.Style>
                                <Style TargetType="MenuItem">
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding SelectedLayer.IsVisible}" Value="True">
                                            <Setter Property="Header" Value="👁️‍🗨️ Hide"/>
                                        </DataTrigger>
                                        <DataTrigger Binding="{Binding SelectedLayer.IsVisible}" Value="False">
                                            <Setter Property="Header" Value="🔍 Show"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </MenuItem.Style>
                        </MenuItem>
                        <MenuItem Header="⬇️ Merge Down" 
                          Command="{Binding MergeLayerDownCommand}"/>
                        <MenuItem Header="▲ Move Up" 
                          Command="{Binding MoveLayerUpCommand}"/>
                        <MenuItem Header="▼ Move Down" 
                          Command="{Binding MoveLayerDownCommand}"/>
                        <MenuItem Header="🗑️ Delete" 
                          Command="{Binding DeleteLayerCommand}"/>
                    </ContextMenu>
                </ListView.ContextMenu>
            </ListView>
            <Line Grid.Row="2" Stroke="{DynamicResource ControlElevationBorderBrush}" X1="0" Y1="0" X2="120" Y2="0" StrokeThickness="1"/>
            <Border Grid.Row="2" Margin="0,15,0,20" Width="80" Height="80" MaxHeight="80" MaxWidth="80" BorderBrush="{DynamicResource ControlElevationBorderBrush}" BorderThickness="1" VerticalAlignment="Center" HorizontalAlignment="center" CornerRadius="10">
                <Image Source="{Binding BackgroundLayer}" Margin="2"/>
            </Border>
        </Grid>
    </Border>
</UserControl>
