<Window
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:MVVMPaintApp.Views"
        xmlns:uc="clr-namespace:MVVMPaintApp.UserControls"
        x:Class="MVVMPaintApp.Views.MainCanvasWindow"
        xmlns:conv="clr-namespace:MVVMPaintApp.Converters"
        WindowStartupLocation="CenterScreen"
        mc:Ignorable="d"
        Closing="MainCanvasWindow_Closing"
        PreviewKeyUp="MainCanvasWindow_PreviewKeyUp"
        PreviewKeyDown="MainCanvasWindow_PreviewKeyDown"
        Title="{Binding WindowTitle}" Height="{Binding WindowHeight, Mode=TwoWay}" Width="{Binding WindowWidth, Mode=TwoWay}">
    <Window.Resources>
        <conv:ZoomValueConverter x:Key="ZoomValueConverter"/>
        <DrawingImage x:Key="CursorIcon">
            <DrawingImage.Drawing>
                <DrawingGroup ClipGeometry="M0,0 V32 H32 V0 H0 Z">
                    <GeometryDrawing Brush="{DynamicResource TextFillColorPrimaryBrush}" Geometry="F1 M32,32z M0,0z M9,4.55266L9,27.153 14.4837,19.6451C15.2369,18.614,16.4369,18.0044,17.7136,18.0044L26.2127,18.0044 9,4.55266z M7,3.4862C7,2.25279,8.4195,1.56026,9.39118,2.31963L28.3824,17.1612C29.574,18.0925,28.9156,20.0049,27.4035,20.0049L17.7136,20.0049C17.0752,20.0049,16.4752,20.3097,16.0987,20.8253L9.87386,29.3478C8.96648,30.5901,7,29.9481,7,28.4096L7,3.4862z" />
                </DrawingGroup>
            </DrawingImage.Drawing>
        </DrawingImage>
        <DrawingImage x:Key="SelectionIcon">
            <DrawingImage.Drawing>
                <DrawingGroup ClipGeometry="M0,0 V24 H24 V0 H0 Z">
                    <GeometryDrawing Brush="{DynamicResource TextFillColorPrimaryBrush}" Geometry="F1 M24,24z M0,0z M7,5C7,6.10457 6.10457,7 5,7 3.89543,7 3,6.10457 3,5 3,3.89543 3.89543,3 5,3 6.10457,3 7,3.89543 7,5z M8,4.75C8,5.16421,8.33579,5.5,8.75,5.5L15.25,5.5C15.6642,5.5 16,5.16421 16,4.75 16,4.33579 15.6642,4 15.25,4L8.75,4C8.33579,4,8,4.33579,8,4.75z M4.75,8C4.33579,8,4,8.33579,4,8.75L4,15.25C4,15.6642 4.33579,16 4.75,16 5.16421,16 5.5,15.6642 5.5,15.25L5.5,8.75C5.5,8.33579,5.16421,8,4.75,8z M19.25,8C18.8358,8,18.5,8.33579,18.5,8.75L18.5,15.25C18.5,15.6642 18.8358,16 19.25,16 19.6642,16 20,15.6642 20,15.25L20,8.75C20,8.33579,19.6642,8,19.25,8z M8.75,20C8.33579,20 8,19.6642 8,19.25 8,18.8358 8.33579,18.5 8.75,18.5L15.25,18.5C15.6642,18.5 16,18.8358 16,19.25 16,19.6642 15.6642,20 15.25,20L8.75,20z M5,21C6.10457,21 7,20.1046 7,19 7,17.8954 6.10457,17 5,17 3.89543,17 3,17.8954 3,19 3,20.1046 3.89543,21 5,21z M21,5C21,6.10457 20.1046,7 19,7 17.8954,7 17,6.10457 17,5 17,3.89543 17.8954,3 19,3 20.1046,3 21,3.89543 21,5z M19,21C20.1046,21 21,20.1046 21,19 21,17.8954 20.1046,17 19,17 17.8954,17 17,17.8954 17,19 17,20.1046 17.8954,21 19,21z" />
                </DrawingGroup>
            </DrawingImage.Drawing>
        </DrawingImage>
        <DrawingImage x:Key="CanvasSizeIcon">
            <DrawingImage.Drawing>
                <DrawingGroup ClipGeometry="M0,0 V24 H24 V0 H0 Z">
                    <GeometryDrawing Brush="{DynamicResource TextFillColorPrimaryBrush}" Geometry="F1 M24,24z M0,0z M16.78,7.22C16.922,7.36,17,7.551,17,7.75L17,10.25A0.75,0.75,0,0,1,15.5,10.25L15.5,9.56 13.78,11.28A0.75,0.75,0,1,1,12.72,10.219L14.44,8.5 13.75,8.5A0.75,0.75,0,0,1,13.75,7L16.25,7A0.75,0.75,0,0,1,16.78,7.22z M7,16.25A0.75,0.75,0,0,0,7.75,17L10.251,17A0.75,0.75,0,0,0,10.251,15.5L9.561,15.5 11.281,13.78A0.75,0.75,0,0,0,10.22,12.72L8.5,14.438 8.5,13.748A0.75,0.75,0,0,0,7,13.748L7,16.248z" />
                    <GeometryDrawing Brush="{DynamicResource TextFillColorPrimaryBrush}" Geometry="F1 M24,24z M0,0z M2,6.75A2.75,2.75,0,0,1,4.75,4L19.25,4A2.75,2.75,0,0,1,22,6.75L22,17.25A2.75,2.75,0,0,1,19.25,20L4.75,20A2.75,2.75,0,0,1,2,17.25L2,6.75z M4.75,5.5C4.06,5.5,3.5,6.06,3.5,6.75L3.5,17.25C3.5,17.94,4.06,18.5,4.75,18.5L19.25,18.5C19.94,18.5,20.5,17.94,20.5,17.25L20.5,6.75C20.5,6.06,19.94,5.5,19.25,5.5L4.75,5.5z" />
                </DrawingGroup>
            </DrawingImage.Drawing>
        </DrawingImage>
        <DrawingImage x:Key="FitToWindowIcon">
            <DrawingImage.Drawing>
                <DrawingGroup ClipGeometry="M0,0 V24 H24 V0 H0 Z">
                    <GeometryDrawing Brush="{DynamicResource TextFillColorPrimaryBrush}" Geometry="F1 M24,24z M0,0z M18.25,4A3.75,3.75,0,0,1,22,7.75L22,16.25A3.75,3.75,0,0,1,18.25,20L5.75,20A3.75,3.75,0,0,1,2,16.25L2,7.75A3.75,3.75,0,0,1,5.75,4L18.25,4z M18.25,5.5L5.75,5.5A2.25,2.25,0,0,0,3.5,7.75L3.5,16.25A2.25,2.25,0,0,0,5.75,18.5L18.25,18.5A2.25,2.25,0,0,0,20.5,16.25L20.5,7.75A2.25,2.25,0,0,0,18.25,5.5z M18.25,13A0.75,0.75,0,0,1,19,13.75L19,15A2,2,0,0,1,17,17L15.75,17A0.75,0.75,0,0,1,15.75,15.5L17,15.5A0.5,0.5,0,0,0,17.5,15L17.5,13.75A0.75,0.75,0,0,1,18.25,13z M5.75,13A0.75,0.75,0,0,1,6.5,13.75L6.5,15A0.5,0.5,0,0,0,7,15.5L8.25,15.5A0.75,0.75,0,0,1,8.25,17L7,17A2,2,0,0,1,5,15L5,13.75A0.75,0.75,0,0,1,5.75,13z M7,7L8.25,7A0.75,0.75,0,0,1,8.352,8.493L8.25,8.5 7,8.5A0.5,0.5,0,0,0,6.508,8.91L6.5,9 6.5,10.25A0.75,0.75,0,0,1,5.007,10.352L5,10.25 5,9A2,2,0,0,1,6.85,7.005L7,7z M17,7A2,2,0,0,1,19,9L19,10.25A0.75,0.75,0,0,1,17.5,10.25L17.5,9A0.5,0.5,0,0,0,17,8.5L15.75,8.5A0.75,0.75,0,0,1,15.75,7L17,7z" />
                </DrawingGroup>
            </DrawingImage.Drawing>
        </DrawingImage>
        <Style x:Key="FitToWindowButtonStyle"
               TargetType="Button"
               BasedOn="{StaticResource DefaultButtonStyle}">
            <Setter Property="Padding" Value="7,1,7,1"/>
            <Setter Property="HorizontalAlignment" Value="Right" />
        </Style>
        <Style x:Key="ZoomComboBoxStyle" 
               TargetType="ComboBox"
               BasedOn="{StaticResource DefaultComboBoxStyle}">
            <Setter Property="Padding" Value="5,4,5,4"/>
        </Style>
    </Window.Resources>

    <Grid ShowGridLines="{Binding ShowGridBorders}">
        <Grid.RowDefinitions>
            <RowDefinition Height="50"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="40"/>
        </Grid.RowDefinitions>

        <Menu Grid.Row="0" Panel.ZIndex="10" Background="{DynamicResource CardBackgroundFillColorSecondaryBrush}">
            <MenuItem Header="File">
                <MenuItem Header="New" Command="{Binding NewCommand}"/>
                <MenuItem Header="Open" Command="{Binding OpenCommand}"/>
                <MenuItem Header="Save" Command="{Binding SaveCommand}"/>
                <MenuItem Header="Save As">
                    <MenuItem Header="PNG" Command="{Binding SaveAsPNGCommand}"/>
                    <MenuItem Header="JPG" Command="{Binding SaveAsJPEGCommand}"/>
                    <MenuItem Header="BMP" Command="{Binding SaveAsBMPCommand}"/>
                </MenuItem>
                <MenuItem Header="Exit" Command="{Binding ExitCommand}"/>
            </MenuItem>
            <MenuItem Header="Edit">
                <MenuItem Header="Undo" Command="{Binding UndoCommand}"/>
                <MenuItem Header="Redo" Command="{Binding RedoCommand}"/>
                <MenuItem Header="Cut" Command="{Binding CutCommand}"/>
                <MenuItem Header="Copy" Command="{Binding CopyCommand}"/>
                <MenuItem Header="Paste" Command="{Binding PasteCommand}"/>
            </MenuItem>
            <MenuItem Header="View">
                <MenuItem Header="Zoom In" Command="{Binding ZoomInCommand}"/>
                <MenuItem Header="Zoom Out" Command="{Binding ZoomOutCommand}"/>
                <MenuItem Header="Fit to Window" Command="{Binding FitToWindowCommand}"/>
            </MenuItem>
            <Separator/>

        </Menu>
        <StatusBar Grid.Row="2" Panel.ZIndex="10" Padding="4" Background="{DynamicResource CardBackgroundFillColorSecondaryBrush}">
            <StatusBarItem Width="120" HorizontalAlignment="Left" VerticalAlignment="Center">
                <Grid x:Name="CursorInfo">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="5"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    <Image Grid.Column="0" Height="20" Source="{StaticResource CursorIcon}" Stretch="UniformToFill"/>
                    <TextBlock Grid.Column="2" Text="{Binding DrawingCanvasViewModel.MousePosOnCanvas}" Foreground="{DynamicResource TextFillColorPrimaryBrush}"/>
                </Grid>
            </StatusBarItem>
            <Separator/>
            <StatusBarItem Width="120" HorizontalAlignment="Left" VerticalAlignment="Center">
                <Grid x:Name="SelectionInfo">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="5"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    <Image Grid.Column="0" Height="20" Source="{StaticResource SelectionIcon}" Stretch="UniformToFill"/>
                    <TextBlock Grid.Column="2" Text="{Binding DrawingCanvasViewModel.SelectionSize}" Foreground="{DynamicResource TextFillColorPrimaryBrush}"/>
                </Grid>
            </StatusBarItem>
            <Separator/>
            <StatusBarItem Width="120" HorizontalAlignment="Left" VerticalAlignment="Center">
                <Grid x:Name="CanvasSizeInfo">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="5"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    <Image Grid.Column="0" Height="20" Source="{StaticResource CanvasSizeIcon}" Stretch="UniformToFill"/>
                    <TextBlock Grid.Column="2" Text="{Binding DrawingCanvasViewModel.CanvasSize}" Foreground="{DynamicResource TextFillColorPrimaryBrush}"/>
                </Grid>
            </StatusBarItem>


            <StatusBarItem Width="380" HorizontalAlignment="Right" Height="40" VerticalAlignment="Center">
                <Grid x:Name="ZoomSlider">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="50"/>
                        <ColumnDefinition Width="5"/>
                        <ColumnDefinition Width="100"/>
                        <ColumnDefinition Width="5"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="5"/>
                        <ColumnDefinition Width="150"/>
                        <ColumnDefinition Width="5"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    <Button Height="25" Width="40" Style="{StaticResource FitToWindowButtonStyle}" Command="{Binding ProjectManager.FitToWindowCommand}">
                        <Image Source="{StaticResource FitToWindowIcon}" VerticalAlignment="Center" Stretch="Uniform"/>
                    </Button>
                    <ComboBox   IsEditable="True"
                                Style="{StaticResource ZoomComboBoxStyle}" Grid.Column="2" Width="80"
                                ItemsSource="{Binding DrawingCanvasViewModel.ZoomPresets}"
                                Text="{Binding ProjectManager.ZoomFactor.Value, 
                                Converter={StaticResource ZoomValueConverter}, 
                                UpdateSourceTrigger=PropertyChanged}"/>
                    <Image Grid.Column="4" Source="/Resources/ZoomSliderDown.png" Width="20" Height="20" VerticalAlignment="Center" Stretch="UniformToFill"/>
                    <Slider Grid.Column="6" Width="150" Minimum="0.1" Maximum="8.0" Value="{Binding DrawingCanvasViewModel.ProjectManager.ZoomFactor.Value, Mode=TwoWay}"/>
                    <Image Grid.Column="8" Source="/Resources/ZoomSliderUp.png" Width="20" Height="20" VerticalAlignment="Center" Stretch="UniformToFill"/>
                </Grid>
            </StatusBarItem>

        </StatusBar>

        <uc:DrawingCanvas Panel.ZIndex="0" Grid.Row="1" VerticalAlignment="Stretch" HorizontalAlignment="Stretch"
                            DataContext="{Binding DrawingCanvasViewModel}"/>
        <DockPanel Grid.Row="1">
            <uc:LayerControl Panel.ZIndex="10" HorizontalAlignment="Right" Margin="10" Grid.Row="1"
                                DataContext="{Binding LayerViewModel}" DockPanel.Dock="Right" VerticalAlignment="Stretch"/>

            <uc:ColorPaletteControl Panel.ZIndex="10" HorizontalAlignment="Left" Margin="30,0,0,30" VerticalAlignment="Top" Grid.Row="1"
                                DataContext="{Binding ColorPaletteViewModel}" DockPanel.Dock="Bottom"/>

            <uc:ToolboxControl Panel.ZIndex="10" HorizontalAlignment="Left" Margin="30" Grid.Row="1"
                               DataContext="{Binding ToolboxViewModel}" DockPanel.Dock="Left" VerticalAlignment="Center"/>
        </DockPanel>
        <Popup IsOpen="{Binding LayerViewModel.IsColorPickerOpen}"
           PlacementTarget="{Binding ElementName=ZoomSlider}" 
           Placement="Top" HorizontalOffset="-380" VerticalOffset="-13" AllowsTransparency="True"
           PopupAnimation="Fade">
            <Border Background="{DynamicResource CardBackgroundFillColorSecondaryBrush}"
                BorderBrush="{DynamicResource ControlElevationBorderBrush}" BorderThickness="2" 
                CornerRadius="15" Padding="10" Width="610">
                <StackPanel>
                    <uc:ColorPickerControl SelectedColor="{Binding Path=DataContext.LayerViewModel.BackgroundColor, 
                                                RelativeSource={RelativeSource FindAncestor, 
                                                AncestorType={x:Type local:MainCanvasWindow}},
                                                Mode=TwoWay}" Margin="0,0,0,-30" />
                    <Button HorizontalAlignment="Right" Content="Set color" Command="{Binding LayerViewModel.SetBackgroundColorCommand}"/>
                </StackPanel>
            </Border>
        </Popup>
    </Grid>
</Window>
